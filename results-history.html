<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EazzyLotto - R√©sultats & Historique</title>
    <script src="assets/js/universal-header.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .header {
            text-align: center;
            color: #1890ff;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #1890ff, #722ed1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .navigation-bar {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .nav-button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 0 5px;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }

        .nav-button:hover {
            background: #40a9ff;
            color: white;
        }

        .nav-button.active {
            background: #722ed1;
        }

        .controls {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        select, button {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        button {
            background: linear-gradient(135deg, #1890ff, #40a9ff);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(24, 144, 255, 0.3);
        }

        .results-dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .results-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            border: 1px solid #e8e8e8;
        }

        .section-title {
            background: linear-gradient(135deg, #1890ff, #722ed1);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: -20px -20px 20px -20px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
        }

        .performance-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .performance-card {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .performance-card.warning {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
        }

        .performance-card.danger {
            background: linear-gradient(135deg, #dc3545, #e83e8c);
        }

        .performance-card h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            opacity: 0.9;
        }

        .performance-card .value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .performance-card .details {
            font-size: 12px;
            opacity: 0.9;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .history-table th,
        .history-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .history-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #1890ff;
        }

        .history-table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
        }

        .status-partial {
            background: #fff3cd;
            color: #856404;
        }

        .status-miss {
            background: #f8d7da;
            color: #721c24;
        }

        .winning-numbers {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .number-ball {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            color: white;
        }

        .number-ball.hit {
            background: #28a745;
        }

        .number-ball.miss {
            background: #6c757d;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background-color: #fff2f0;
            border: 1px solid #ffccc7;
            color: #ff4d4f;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>

<body>
    <!-- Header Universel -->
    <div id="header-container"></div>
    
    <div class="container" style="margin-top: 100px;">
        <div class="header">
            <h1>üèÜ R√©sultats & Historique</h1>
            <p>Suivi des performances et validation des pr√©dictions</p>
        </div>

        <!-- Barre de navigation -->
        <div class="navigation-bar">
            <h4 style="margin: 0 0 10px 0; color: #1890ff;">üß≠ Navigation Avanc√©e</h4>
            <a href="smart-input.html" class="nav-button">üîÑ Sessions Cycliques</a>
            <a href="advanced-journal.html" class="nav-button">üìã Journal Avanc√©</a>
            <a href="pattern-viewer.html" class="nav-button">üîç Patterns</a>
            <a href="prediction-panel.html" class="nav-button">ü§ñ Pr√©dictions ML</a>
            <a href="results-history.html" class="nav-button active">üèÜ R√©sultats</a>
        </div>

        <!-- Contr√¥les -->
        <div class="controls">
            <label for="universeSelect">Univers:</label>
            <select id="universeSelect">
                <option value="mundo" selected>Mundo</option>
                <option value="fruity">Fruity</option>
                <option value="trigga">Trigga</option>
                <option value="roaster">Roaster</option>
                <option value="sunshine">Sunshine</option>
            </select>

            <label for="sessionSelect">Session:</label>
            <select id="sessionSelect">
                <option value="">üåç Toutes les sessions</option>
            </select>

            <label for="periodSelect">P√©riode:</label>
            <select id="periodSelect">
                <option value="">Toutes les p√©riodes</option>
                <option value="7">7 derniers jours</option>
                <option value="30">30 derniers jours</option>
                <option value="90">90 derniers jours</option>
            </select>

            <button onclick="loadResults()" id="loadBtn">üìä Charger R√©sultats</button>
            <button onclick="exportResults()" id="exportBtn" style="background: linear-gradient(135deg, #52c41a, #73d13d);">üì• Exporter</button>
        </div>

        <!-- Dashboard des r√©sultats -->
        <div class="results-dashboard">
            <!-- Performances globales -->
            <div class="results-section">
                <h2 class="section-title">üìà Performances Globales</h2>
                <div id="performanceMetrics" class="performance-cards"></div>
            </div>

            <!-- Statistiques d√©taill√©es -->
            <div class="results-section">
                <h2 class="section-title">üéØ Pr√©cision par Type</h2>
                <div id="accuracyStats" class="performance-cards"></div>
            </div>
        </div>

        <!-- Historique d√©taill√© -->
        <div class="results-section">
            <h2 class="section-title">üìã Historique des Pr√©dictions</h2>
            <div id="historyContainer">
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Session</th>
                            <th>Univers</th>
                            <th>Pr√©diction</th>
                            <th>R√©sultat</th>
                            <th>Pr√©cision</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="historyTableBody">
                        <!-- Donn√©es charg√©es dynamiquement -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/analytics';
        let currentData = null;

        // Initialisation
        document.addEventListener('DOMContentLoaded', function () {
            // Injecter le header universel
            if (typeof UniversalHeader !== 'undefined') {
                UniversalHeader.injectHeader('header-container', 'results', {
                    showNavigation: true,
                    showUserInfo: true
                });
            }
            
            console.log('üèÜ Initialisation des r√©sultats et historique...');
            loadSessions();
            loadResults();
        });

        async function loadSessions() {
            try {
                const response = await fetch('http://localhost:8000/api/session/sessions');
                const data = await response.json();
                
                if (response.ok) {
                    const sessions = data.value || data;
                    populateSessionSelect(sessions);
                } else {
                    console.log('API sessions non disponible, utilisation des sessions de test');
                    populateSessionSelect(getTestSessions());
                }
            } catch (error) {
                console.log('Erreur sessions, utilisation des sessions de test:', error);
                populateSessionSelect(getTestSessions());
            }
        }

        function getTestSessions() {
            return [
                { id: 1, name: 'Loto Fran√ßais (6/49)', is_active: true },
                { id: 2, name: 'EuroMillions (5/50)', is_active: true },
                { id: 3, name: 'Loto US (6/90)', is_active: false },
                { id: 4, name: 'Keno (10/80)', is_active: true }
            ];
        }

        function populateSessionSelect(sessions) {
            const select = document.getElementById('sessionSelect');
            
            // Garder l'option globale
            select.innerHTML = '<option value="">üåç Toutes les sessions</option>';
            
            if (Array.isArray(sessions)) {
                sessions.forEach(session => {
                    const option = document.createElement('option');
                    option.value = session.id;
                    const status = session.is_active ? 'Active' : 'Inactive';
                    option.textContent = `üìã Session ${session.id} - ${session.name} (${status})`;
                    select.appendChild(option);
                });
            }
        }

        async function loadResults() {
            const loadBtn = document.getElementById('loadBtn');
            const universe = document.getElementById('universeSelect').value;
            const sessionId = document.getElementById('sessionSelect').value;
            const period = document.getElementById('periodSelect').value;

            loadBtn.disabled = true;
            loadBtn.textContent = 'üîÑ Chargement...';

            try {
                // Simuler des donn√©es de r√©sultats (en attendant l'API r√©elle)
                const mockResults = generateMockResults(universe, sessionId, period);
                
                displayPerformanceMetrics(mockResults.performance);
                displayAccuracyStats(mockResults.accuracy);
                displayHistoryTable(mockResults.history);

            } catch (error) {
                showError('Erreur lors du chargement: ' + error.message);
            } finally {
                loadBtn.disabled = false;
                loadBtn.textContent = 'üìä Charger R√©sultats';
            }
        }

        function generateMockResults(universe, sessionId, period) {
            // Donn√©es simul√©es pour d√©monstration
            return {
                performance: {
                    totalPredictions: 127,
                    successRate: 78.5,
                    partialHits: 45,
                    totalHits: 89,
                    avgConfidence: 82.3
                },
                accuracy: {
                    chip: { rate: 85.2, total: 45 },
                    tome: { rate: 72.1, total: 38 },
                    granque: { rate: 79.8, total: 42 },
                    forme: { rate: 68.5, total: 35 }
                },
                history: [
                    {
                        date: '2024-01-15',
                        session: 'Loto Fran√ßais',
                        universe: 'mundo',
                        prediction: [5, 12, 23, 31, 42, 47],
                        result: [5, 12, 18, 31, 39, 47],
                        accuracy: 66.7,
                        status: 'partial'
                    },
                    {
                        date: '2024-01-14',
                        session: 'EuroMillions',
                        universe: 'fruity',
                        prediction: [8, 15, 22, 29, 35],
                        result: [8, 15, 22, 29, 35],
                        accuracy: 100,
                        status: 'success'
                    },
                    {
                        date: '2024-01-13',
                        session: 'Loto US',
                        universe: 'trigga',
                        prediction: [3, 17, 24, 33, 41, 48],
                        result: [7, 14, 21, 28, 35, 42],
                        accuracy: 0,
                        status: 'miss'
                    }
                ]
            };
        }

        function displayPerformanceMetrics(performance) {
            const container = document.getElementById('performanceMetrics');
            
            const html = `
                <div class="performance-card">
                    <h3>Pr√©dictions Totales</h3>
                    <div class="value">${performance.totalPredictions}</div>
                    <div class="details">Depuis le d√©but</div>
                </div>
                <div class="performance-card">
                    <h3>Taux de R√©ussite</h3>
                    <div class="value">${performance.successRate}%</div>
                    <div class="details">Moyenne g√©n√©rale</div>
                </div>
                <div class="performance-card warning">
                    <h3>Succ√®s Partiels</h3>
                    <div class="value">${performance.partialHits}</div>
                    <div class="details">2-4 num√©ros corrects</div>
                </div>
                <div class="performance-card">
                    <h3>Confiance Moyenne</h3>
                    <div class="value">${performance.avgConfidence}%</div>
                    <div class="details">Algorithmes ML</div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function displayAccuracyStats(accuracy) {
            const container = document.getElementById('accuracyStats');
            
            let html = '';
            
            for (const [type, stats] of Object.entries(accuracy)) {
                const cardClass = stats.rate > 80 ? '' : stats.rate > 60 ? 'warning' : 'danger';
                
                html += `
                    <div class="performance-card ${cardClass}">
                        <h3>${type.toUpperCase()}</h3>
                        <div class="value">${stats.rate}%</div>
                        <div class="details">${stats.total} pr√©dictions</div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        function displayHistoryTable(history) {
            const tbody = document.getElementById('historyTableBody');
            
            let html = '';
            
            history.forEach(record => {
                const statusClass = record.status === 'success' ? 'status-success' : 
                                  record.status === 'partial' ? 'status-partial' : 'status-miss';
                
                const statusText = record.status === 'success' ? 'Succ√®s' : 
                                 record.status === 'partial' ? 'Partiel' : '√âchec';
                
                // G√©n√©rer les boules de num√©ros
                const predictionBalls = record.prediction.map(num => {
                    const isHit = record.result.includes(num);
                    return `<div class="number-ball ${isHit ? 'hit' : 'miss'}">${num}</div>`;
                }).join('');
                
                html += `
                    <tr>
                        <td>${record.date}</td>
                        <td>${record.session}</td>
                        <td>${record.universe}</td>
                        <td>
                            <div class="winning-numbers">${predictionBalls}</div>
                        </td>
                        <td>${record.result.join(', ')}</td>
                        <td>${record.accuracy}%</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        function exportResults() {
            // Simuler l'export des r√©sultats
            const data = {
                timestamp: new Date().toISOString(),
                universe: document.getElementById('universeSelect').value,
                session: document.getElementById('sessionSelect').value,
                results: 'Donn√©es export√©es avec succ√®s'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `eazzylotto-results-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            console.log('‚úÖ R√©sultats export√©s avec succ√®s');
        }

        function showError(message) {
            const errorHtml = `<div class="error">${message}</div>`;
            document.getElementById('performanceMetrics').innerHTML = errorHtml;
        }
    </script>
</body>

</html>