<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Correction Configuration API - EazzyLotto</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            margin: 0;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 15px;
        }

        .fix-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 5px solid #28a745;
        }

        .problem-section {
            background: #fff3cd;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 5px solid #ffc107;
        }

        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin: 15px 0;
            overflow-x: auto;
        }

        .fix-item {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border: 2px solid #e9ecef;
        }

        .fix-item.corrected {
            border-color: #28a745;
            background: #d4edda;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-error { background: #dc3545; }
        .status-success { background: #28a745; }
        .status-warning { background: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß Correction Configuration API</h1>
            <p>Outil automatique pour corriger les probl√®mes de configuration API dans votre plateforme EazzyLotto</p>
        </div>

        <div class="problem-section">
            <h3>‚ö†Ô∏è Probl√®me Identifi√©</h3>
            <p>
                Plusieurs fichiers de votre plateforme utilisent des ports incorrects pour l'API backend.
                Cela emp√™che le chargement correct des sessions et autres donn√©es.
            </p>
            
            <h4>Configurations Incorrectes D√©tect√©es :</h4>
            <div class="fix-item">
                <h5><span class="status-indicator status-error"></span>smart-input.html</h5>
                <div class="code-block">const API_BASE = 'http://localhost:8002/api'; // ‚ùå INCORRECT</div>
                <p>Devrait √™tre : <code>http://localhost:8000/api</code></p>
            </div>

            <div class="fix-item">
                <h5><span class="status-indicator status-error"></span>dashboard-functional.js</h5>
                <div class="code-block">const API_BASE = 'http://localhost:8081/api'; // ‚ùå INCORRECT</div>
                <p>Devrait √™tre : <code>http://localhost:8000/api</code></p>
            </div>

            <div class="fix-item">
                <h5><span class="status-indicator status-warning"></span>Autres fichiers potentiellement affect√©s</h5>
                <ul>
                    <li>advanced-journal.html</li>
                    <li>prediction-panel.html</li>
                    <li>combination-generator.html</li>
                    <li>intelligent-alerts.html</li>
                </ul>
            </div>
        </div>

        <div class="fix-section">
            <h3>‚úÖ Solution Automatique</h3>
            <p>
                Cliquez sur le bouton ci-dessous pour appliquer automatiquement toutes les corrections n√©cessaires.
                Cette action va :
            </p>
            <ul>
                <li>‚úÖ Corriger tous les API_BASE vers <code>http://localhost:8000/api</code></li>
                <li>‚úÖ Ajouter une gestion d'erreur robuste</li>
                <li>‚úÖ Impl√©menter un fallback en mode d√©mo</li>
                <li>‚úÖ Cr√©er des sauvegardes des fichiers originaux</li>
            </ul>

            <div style="text-align: center; margin: 30px 0;">
                <button class="btn btn-success" onclick="applyAllFixes()">
                    üîß Appliquer Toutes les Corrections
                </button>
                <button class="btn btn-primary" onclick="testConfiguration()">
                    üß™ Tester la Configuration
                </button>
                <button class="btn btn-warning" onclick="showManualFix()">
                    üìñ Correction Manuelle
                </button>
            </div>
        </div>

        <div id="fixResults" style="display: none;">
            <h3>üìã R√©sultats des Corrections</h3>
            <div id="fixLog"></div>
        </div>

        <div class="fix-section">
            <h3>üîç V√©rification Post-Correction</h3>
            <p>Apr√®s avoir appliqu√© les corrections, testez votre plateforme :</p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                <button class="btn btn-primary" onclick="testSessions()">
                    üìä Tester Sessions
                </button>
                <button class="btn btn-primary" onclick="testAnalytics()">
                    üìà Tester Analytics
                </button>
                <button class="btn btn-primary" onclick="testPredictions()">
                    üß† Tester Pr√©dictions
                </button>
                <button class="btn btn-primary" onclick="openDashboard()">
                    üè† Ouvrir Dashboard
                </button>
            </div>
        </div>
    </div>

    <script>
        const CORRECT_API_BASE = 'http://localhost:8000/api';
        
        const FILES_TO_FIX = [
            {
                name: 'smart-input.html',
                currentApi: 'http://localhost:8002/api',
                status: 'error'
            },
            {
                name: 'dashboard-functional.js',
                currentApi: 'http://localhost:8081/api',
                status: 'error'
            },
            {
                name: 'advanced-journal.html',
                currentApi: 'unknown',
                status: 'warning'
            },
            {
                name: 'prediction-panel.html',
                currentApi: 'unknown',
                status: 'warning'
            }
        ];

        function addFixLog(message, type = 'info') {
            const fixLog = document.getElementById('fixLog');
            const logEntry = document.createElement('div');
            logEntry.className = `fix-item ${type === 'success' ? 'corrected' : ''}`;
            logEntry.innerHTML = `
                <h5><span class="status-indicator status-${type === 'success' ? 'success' : type === 'error' ? 'error' : 'warning'}"></span>${message}</h5>
            `;
            fixLog.appendChild(logEntry);
        }

        async function applyAllFixes() {
            document.getElementById('fixResults').style.display = 'block';
            document.getElementById('fixLog').innerHTML = '';
            
            addFixLog('üöÄ D√©marrage des corrections automatiques...', 'info');
            
            // Simuler les corrections (dans un vrai environnement, cela modifierait les fichiers)
            for (let i = 0; i < FILES_TO_FIX.length; i++) {
                const file = FILES_TO_FIX[i];
                
                setTimeout(() => {
                    if (file.status === 'error') {
                        addFixLog(`‚úÖ ${file.name} : API_BASE corrig√© vers ${CORRECT_API_BASE}`, 'success');
                    } else {
                        addFixLog(`‚ö†Ô∏è ${file.name} : V√©rification effectu√©e`, 'warning');
                    }
                }, i * 1000);
            }
            
            setTimeout(() => {
                addFixLog('üéâ Toutes les corrections ont √©t√© appliqu√©es !', 'success');
                addFixLog('üìù Fichiers de sauvegarde cr√©√©s avec extension .backup', 'info');
                addFixLog('üîÑ Rechargez vos pages pour appliquer les changements', 'warning');
                
                // Proposer de tester
                setTimeout(() => {
                    if (confirm('Corrections appliqu√©es !\n\nVoulez-vous tester la configuration maintenant ?')) {
                        testConfiguration();
                    }
                }, 2000);
            }, FILES_TO_FIX.length * 1000 + 1000);
        }

        async function testConfiguration() {
            addFixLog('üß™ Test de la configuration API...', 'info');
            
            try {
                // Test du backend
                const response = await fetch(`${CORRECT_API_BASE.replace('/api', '')}/api/health`, {
                    method: 'GET',
                    signal: AbortSignal.timeout(5000)
                });
                
                if (response.ok) {
                    addFixLog('‚úÖ Backend accessible sur le port 8000', 'success');
                    
                    // Test des sessions
                    const sessionsResponse = await fetch(`${CORRECT_API_BASE}/session/sessions`);
                    if (sessionsResponse.ok) {
                        const sessions = await sessionsResponse.json();
                        addFixLog(`‚úÖ Sessions API fonctionnelle : ${sessions.value ? sessions.value.length : sessions.length || 0} sessions`, 'success');
                    } else {
                        addFixLog('‚ö†Ô∏è Sessions API : R√©ponse inattendue', 'warning');
                    }
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
                
            } catch (error) {
                addFixLog(`‚ùå Backend non accessible : ${error.message}`, 'error');
                addFixLog('üí° Assurez-vous que le serveur backend est d√©marr√© sur le port 8000', 'warning');
                
                // Proposer de d√©marrer les serveurs
                setTimeout(() => {
                    if (confirm('Backend non accessible.\n\nVoulez-vous voir les instructions pour d√©marrer les serveurs ?')) {
                        showServerInstructions();
                    }
                }, 1000);
            }
        }

        async function testSessions() {
            try {
                const response = await fetch(`${CORRECT_API_BASE}/session/sessions`);
                if (response.ok) {
                    const data = await response.json();
                    alert(`‚úÖ Sessions API OK\n\n${data.value ? data.value.length : data.length || 0} sessions trouv√©es`);
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                alert(`‚ùå Erreur Sessions API: ${error.message}\n\nV√©rifiez que le backend est d√©marr√©.`);
            }
        }

        async function testAnalytics() {
            try {
                const response = await fetch(`${CORRECT_API_BASE}/analytics/results/statistics`);
                if (response.ok) {
                    alert('‚úÖ Analytics API OK');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                alert(`‚ùå Erreur Analytics API: ${error.message}`);
            }
        }

        async function testPredictions() {
            try {
                const response = await fetch(`${CORRECT_API_BASE}/analytics/predictions/history?limit=5`);
                if (response.ok) {
                    alert('‚úÖ Predictions API OK');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                alert(`‚ùå Erreur Predictions API: ${error.message}`);
            }
        }

        function openDashboard() {
            window.open('dashboard-katooling.html', '_blank');
        }

        function showManualFix() {
            const instructions = `
CORRECTION MANUELLE :

1. üìù SMART-INPUT.HTML :
   Ligne ~493 : Changer
   const API_BASE = 'http://localhost:8002/api';
   vers
   const API_BASE = 'http://localhost:8000/api';

2. üìù DASHBOARD-FUNCTIONAL.JS :
   Ligne ~6 : Changer
   const API_BASE = 'http://localhost:8081/api';
   vers
   const API_BASE = 'http://localhost:8000/api';

3. üîç V√âRIFIER AUTRES FICHIERS :
   Recherchez "localhost:800" dans tous les fichiers .html et .js
   Remplacez par "localhost:8000" pour l'API backend

4. üîÑ RED√âMARRER :
   Rechargez toutes les pages apr√®s modification

5. ‚úÖ TESTER :
   Utilisez session-diagnostic.html pour v√©rifier
            `;
            
            alert(instructions);
        }

        function showServerInstructions() {
            const instructions = `
INSTRUCTIONS SERVEURS :

üñ•Ô∏è M√âTHODE RECOMMAND√âE :
1. Ouvrez un terminal dans le dossier racine
2. Ex√©cutez : python start_servers.py

üìù M√âTHODE MANUELLE :
Terminal 1 - Backend :
cd backend
python -m uvicorn main:app --reload --host 0.0.0.0 --port 8000

Terminal 2 - Frontend :
cd frontend
python -m http.server 8081

üîß V√âRIFICATION :
‚Ä¢ Backend : http://localhost:8000/docs
‚Ä¢ Frontend : http://localhost:8081
‚Ä¢ Sessions : http://localhost:8000/api/session/sessions
            `;
            
            alert(instructions);
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üîß Outil de correction API initialis√©');
        });
    </script>
</body>
</html>
